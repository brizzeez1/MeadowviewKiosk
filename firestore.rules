rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    function isSignedIn() {
      return request.auth != null;
    }

    // Main ward doc: wards/{wardId}
    match /wards/{wardId} {
      // Let the kiosk read ward config
      allow read: if true;

      // Lock down edits to ward config for now
      allow write: if false;

      // wards/{wardId}/missionaries/{missionaryId}
      match /missionaries/{missionaryId} {
        allow read: if true;
        allow write: if false; // keep locked for now
      }

      // wards/{wardId}/templeSquares/{squareId}
      match /templeSquares/{squareId} {
        allow read: if true;

        // If you ever write directly from the client, require sign-in
        // (your current save is via Cloud Function, so this can stay strict)
        allow create, update: if isSignedIn();
        allow delete: if false;
      }

      // wards/{wardId}/stats/{docId}
      match /stats/{docId} {
        allow read: if true;
        allow write: if isSignedIn();
      }

      // Optional future: selfies / videos subcollections, lock for now
      match /{sub=**} {
        allow read, write: if false;
      }
    }

    // Everything else closed
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
